# trying for a mil

import numpy as np
from qiskit import QuantumCircuit
from qiskit_ibm_runtime import QiskitRuntimeService, SamplerV2 as Sampler
from qiskit.transpiler.preset_passmanagers import generate_preset_pass_manager

service = QiskitRuntimeService(
    channel="ibm_cloud",
    token="MVe5phDGE9XbcDg3SoVmMYCMCiFxH178gYk7CkaKq3hK",
    instance="crn:v1:bluemix:public:quantum-computing:us-east:a/77e4bd4e9fcb4f6b83714ce02037a001:14996580-386a-4a73-8b95-f445d9653efc::",
)

available_backends = service.backends()
print("Available backends:", available_backends)

backend = service.least_busy(operational=True, simulator=False)
print("Using backend:", backend.name)

# Define + transpile once
qc = QuantumCircuit(1)
qc.h(0)
qc.measure_all()
pm = generate_preset_pass_manager(backend=backend, optimization_level=1)
qc_transpiled = pm.run(qc)

sampler = Sampler(mode=backend)

def get_bits(num_shots=32768):
    job = sampler.run([qc_transpiled], shots=num_shots)
    result = job.result()
    bitstrings = result[0].data.meas.get_bitstrings()
    return bitstrings

target_bits = 1000000
all_bits = []

while len(all_bits) < target_bits:
    all_bits.extend(get_bits())
    print(f"Collected {len(all_bits)} bits so far...")

all_bits = all_bits[:target_bits]

with open("qrng_bits.txt", "w") as f:
    f.write("".join(all_bits))

print("Done! Got 1,000,000 random bits.")
print(all_bits[:50])  # show first 50 bits
print("".join(all_bits[:100]))  # print first 100 as a continuous string
print("Saved all bits to 'qrng_bits.txt'")


'''
(cutie) mikaelapasiou@Mikaelas-MacBook-Pro qrng %  cd /Users/mikaelapasiou/qrng ; /usr/bin/env /Users/mikaelapasiou/qrng/.venv/bin/python /
Users/mikaelapasiou/.vscode/extensions/ms-python.debugpy-2025.10.0-darwin-arm64/bundled/libs/debugpy/adapter/../../debugpy/launcher 54358 -
- /Users/mikaelapasiou/qrng/trying_ibm.py 
Collected 32768 bits so far...
Collected 65536 bits so far...
Collected 98304 bits so far...
Collected 131072 bits so far...
Collected 163840 bits so far...
Collected 196608 bits so far...
Collected 229376 bits so far...
Collected 262144 bits so far...
Collected 294912 bits so far...
Collected 327680 bits so far...
Collected 360448 bits so far...
Collected 393216 bits so far...
Collected 425984 bits so far...
Collected 458752 bits so far...
Collected 491520 bits so far...
Collected 524288 bits so far...
Collected 557056 bits so far...
Collected 589824 bits so far...
Collected 622592 bits so far...
Collected 655360 bits so far...
Collected 688128 bits so far...
Collected 720896 bits so far...
Collected 753664 bits so far...
Collected 786432 bits so far...
Collected 819200 bits so far...
Collected 851968 bits so far...
Collected 884736 bits so far...
Collected 917504 bits so far...
Collected 950272 bits so far...
Collected 983040 bits so far...
Collected 1015808 bits so far...
Done! Got 1,000,000 random bits.
'''
